<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.indo.admin.modules.mem.mapper.MemSubordinateMapper">

    <sql id="Base_Column_List">
    id, mem_id, level_num,team_num,level_user_ids,parent_id,hierarchy,create_time, update_time, is_del, remark
  </sql>

    <select id="selectMemSubordinate" parameterType="com.indo.user.pojo.dto.MemSubordinateDto"
            resultType="com.indo.user.pojo.vo.MemSubordinateVo">
        select
        t1.id, t1.mem_id, t1.level_num,t1.team_num,t1.level_user_ids,t1.parent_id,t1.hierarchy,t1.create_time, t1.update_time, t1.is_del, t1.remark,
        t2.account, t2.invite_code, t2.Identity_type,
        (select count(*) from mem_subordinate as t3 where t1.mem_id= t3.parent_id and t3.is_del = 0) as register
        from mem_subordinate t1
        left join mem_baseinfo t2 on t1.mem_id = t2.id
        where t1.is_del = 0
        <if test="dto.IdentityType != null ">and t2.Identity_type = #{dto.IdentityType}</if>
        <if test="dto.account != null  and dto.account != ''">and t2.account like concat('%', #{dto.account}, '%')</if>
        <if test="dto.inviteCode != null  and dto.inviteCode != ''">and t2.invite_code like concat('%', #{dto.inviteCode}, '%')</if>
        <if test="dto.beginTime != null and dto.beginTime != ''">
            and date_format(t1.create_time,'%y%m%d') &gt;= date_format(#{dto.beginTime},'%y%m%d')
        </if>
        <if test="dto.endTime != null and dto.endTime != ''">
            and date_format(t1.create_time,'%y%m%d') &lt;= date_format(#{dto.endTime},'%y%m%d')
        </if>
        <if test="dto.ids != null and dto.ids.size()>0">
            t1.id in
            <foreach collection="dto.ids" item="valueList" open="(" close=")" separator=",">
                #{valueList}
            </foreach>
        </if>
        ORDER BY t1.create_time desc
    </select>
</mapper>
